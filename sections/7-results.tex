\chapter{Network evaluation} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{chap:results} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This chapter provides a comprehensive evaluation of how the new CNN approach behaves. Four
categories of understanding are explored (each a section of this chapter):
\begin{enumerate}
    \item Determining the beam selection and energy estimation performance.
    \item Explaining the inner workings of the trained networks.
    \item Studying how robust the network outputs are to changes in the input.
    \item Exploring alternative implementations to see which factors drive performance.
\end{enumerate}

Beforehand, a key and hugely impactful advantage of the CNN approach must be highlighted. Although
the time taken to train all the CNNs in this work is approximately two days, once trained the time
required to calculate all network outputs (inference time) for a single event is on the order of
\unit{2}{\mathrm{ms}}. When combined with event seeding and map generation, the total time taken
to fully reconstruct and classify a raw event is less than \unit{0.2}{\mathrm{seconds}}.

Armed with this incredible speed, the time taken to process a large dataset containing millions of
events becomes a matter of hours. Compared to the many weeks typically required for such a
dataset, when using standard methods, the far-reaching implications for the rapid iteration of
analyses becomes clear. By removing the processing bottleneck, larger datasets can be used, and
new analysis techniques can be quickly tested without concern for the time required.

\section{Performance} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Here the performance of the CNN approach is presented and compared to that achieved by the
standard \chips methods as well as comparable experiments. Primarily this focuses on the principle
aim of selecting an efficient and pure appeared CC $\nu_{e}$ signal sample with accurate neutrino
energy estimation. However, the survived CC $\nu_{\mu}$ selection is also presented for
completeness.

\subsection{Evaluation sample and preselection} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval_sample} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A statistically independent sample of events is used to evaluate the combined performance of the
trained CNNs. The evaluation sample consists of 400000 beam and 350000 cosmic muon events,
produced in the same way as the training and validation events using the detector simulation and
event generation methods outlined in Section.~\ref{sec:chips_monte_carlo}, with a \chipsfive
geometry. The beam events include the expected $\nu_{\mu}$, $\bar{\nu}_{\mu}$, $\nu_{e}$ and
$\bar{\nu}_{e}$ components of the beam as well as events generated to mimic the appeared
(sometimes referred to as \emph{App}) $\nu_{e}$ component. Only the neutrino mode (forward horn
current) of NuMI beam operation is considered for simplicity.

All evaluation events are weighted to match the expected spectrum at the \chipsfive detector,
using the unoscillated flux, cross-sections, and oscillation probabilities (including the MSW
effect). Additional weighting also scales events to match data taking in the NuMI beam for a
single year, corresponding to $6\times 10^{20}$ protons on target (POT). For simplicity, the
neutrino and antineutrino components of the beam are also combined as they are impossible to tell
apart in practice. Cosmic muon events are weighted according to the \unit{11.8}{\mathrm{kHz}} and
\unit{50}{\mathrm{m}} of overburden outlined in Section.~\ref{sec:chips_monte_carlo_cosmic}. The
final weighted spectrum of events is shown in Fig.~\ref{fig:explore_osc_fluxes} with the
combination of underlying beam neutrino interaction types shown in
Fig.~\ref{fig:explore_stacked_int_types}.

\begin{figure} % OSC FLUXES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/explore_osc_fluxes.pdf}
    \caption[Weighted spectrum of evaluation sample events]
    {Weighted spectrum of events contained within the evaluation sample. The weighting is designed
        to mimic the expected event spectrum of the \chipsfive detector. Beam events are weighted
        by combining the expected unoscillated flux with cross-sections and standard oscillation
        probabilities, while cosmic events are weighted using the expected cosmic rate and
        overburden. Shown in blue, green and olive are the surviving CC $\nu_{\mu}$, appearing CC
        $\nu_{e}$ and the intrinsic beam CC $\nu_{e}$ spectra respectively, binned in terms of
        their neutrino energy. Shown in red is the NC event spectra binned in terms of the energy
        of the hadronic component (excluding the outgoing neutrino energy) to represent more
        accurately the energy visible to the detector. Finally, shown in black is the cosmic muon
        event spectra binned in terms of the muon energy.}
    \label{fig:explore_osc_fluxes}
\end{figure}

\begin{figure} % STACK INT TYPES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/explore_stacked_int_types.pdf}
    \caption[Weighted spectrum of interaction types within the evaluation sample]
    {Weighted spectrum of $\nu_{\mu}$ and $\nu_{e}$ beam events contained within the evaluation
        sample separated by interaction type. CC events are binned in terms of neutrino energy
        while NC events are binned in terms of the hadronic component energy.}
    \label{fig:explore_stacked_int_types}
\end{figure}

Separate from the CNN driven work, a simple preselection is applied to all evaluation sample
events. Designed to reject cosmic and NC events while keeping the efficiency of CC beam events
high, the preselection consists of four simple cuts, shown in Fig.~\ref{fig:explore_simple_cuts}.
Firstly, the total number of collected photoelectrons (charge) across all PMTs in the event must
be greater than 250. Secondly, the maximum Hough transform space height must be greater than 250
photoelectrons. Thirdly, the leading seed $\cos(\theta)$ direction must be between $\pm$0.7.
Finally, the leading seed $\phi$ direction must be between $\pm$1.1 radians. The first two cuts
reject low energy events which are usually NC in nature, while the last two reject events whose
activity is not along the beamline, typically cosmic.

\begin{figure} % SIMPLE CUTS DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explore_simple_cuts.pdf}
    \caption[Plots detailing evaluation sample preselection cuts]
    {Plots showing the four simple preselection cuts and how they affect the different event
        categories. The greyed out regions indicate rejected events.}
    \label{fig:explore_simple_cuts}
\end{figure}

\subsection{Cosmic rejection and containment} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval_cosmic} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The \emph{cosmic score} output from the trained cosmic rejection network gives excellent
separation between beam like (output close to zero) and cosmic like (output close to one) events,
as can be seen in Fig.~\ref{fig:cosmic_outputs}. Notably, the vast majority of beam events are
associated with a score incredibly close to zero as is more clearly shown in
Fig.~\ref{fig:cosmic_zoomed_outputs}. Given this, a tight \emph{cosmic score} cut of below
$0.0001$ is chosen by inspection to select beam like events. Out of the total 350000 cosmic events
in the evaluation sample, all are rejected by this cut alongside preselection. Without the
addition of the second \emph{escapes score} output during training, a trained cosmic rejection
network instead allows five cosmic events to pass preselection and the cut above.

\begin{figure} % COSMIC OUTPUTS DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_cosmic_outputs.pdf}
    \caption[Distribution of cosmic score output values]
    {Distribution of \emph{cosmic score} output values from the trained cosmic rejection network
        for the different event categories. A score close to one signifies a cosmic like event,
        while a score close to zero corresponds to a beam like event. Only preselected events are
        shown to better highlight the events this output aims to classify.}
    \label{fig:cosmic_outputs}
\end{figure}

\begin{figure} % COSMIC OUTPUTS ZOOMED DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_cosmic_zoomed_outputs.pdf}
    \caption[Distribution of cosmic score output values close to zero]
    {Distribution of \emph{cosmic score} output values from the trained cosmic rejection network
        close to zero for the different event categories. The cosmic rejection cut value at 0.0001
        is shown with the arrow indicating selected events. No cosmic events are within the shown
        range due to the statistical limitations of the evaluation sample.}
    \label{fig:cosmic_zoomed_outputs}
\end{figure}

It is crucial for accurate neutrino energy estimation that the activity of an event is fully
contained within the volume of the detector. If charged event particles instead leave the detector
and emit Cherenkov radiation not captured by PMTs, it can be incredibly difficult to estimate the
resulting missing energy and hence neutrino energy. Within the \chipsfive detector, this is
particularly important for long track CC $\nu_{\mu}$ events for which only 44\% of the primary
charged muons are fully contained within the detector volume.

Therefore, the second output from the cosmic rejection network, \emph{escapes score} is also used
to select events. Although this output only considers the primary charged lepton instead of all
particles in an event, it still acts as a reasonable proxy for event containment. The distribution
of \emph{escapes score} output values from the trained cosmic rejection network is shown in
Fig.~\ref{fig:final_escapes_outputs}.

An \emph{escapes score} value below 0.5 is chosen by inspection to select events for which the
primary charged lepton is fully contained within the detector. With this selection, 97\% (96\%) of
CC $\nu_{\mu}$ events for which the primary charged lepton is contained within (escapes) the
detector are classified correctly, resulting in a 95\% purity for the surviving CC $\nu_{\mu}$
sample. As expected, the vast majority of CC $\nu_{e}$ and NC events are selected.

For comparison with other experiments, the escapes cut effectively works as a quasi fiducial
volume cut, but just for an energy-dependent region near the downstream wall of the detector.
Fiducial volume cuts are common in neutrino experiments to remove events whose activity is close
to the detector walls and, therefore, can not be reconstructed well. Future work should explore
how a fully implemented fiducial cut using the reconstructed interaction vertex position impacts
performance.

\begin{figure} % ESCAPES OUTPUTS DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_escapes_outputs.pdf}
    \caption[Distribution of escapes score output values]
    {Distribution of \emph{escapes score} output values from the trained cosmic rejection network
        for the different event categories. A score close to one signifies an escaped primary
        charged lepton like event, while a score close to zero corresponds to a contained primary
        charged lepton like event. The containment cut value at 0.5 is shown with the arrow
        indicating the events that are selected.}
    \label{fig:final_escapes_outputs}
\end{figure}

The total number of expected events per year that pass each successive cut (including
preselection) for each event category is shown in Table.~\ref{tab:selection}. Both CC $\nu_{e}$
categories are selected with an efficiency greater than 90\%, while CC $\nu_{\mu}$ events are
reduced to 40\% efficiency, mainly by the \emph{escapes score} cut, to ensure they are fully
contained. Furthermore, NC events are found to be primarily rejected by the preselection, while
cosmic events are heavily rejected by both the preselection and \emph{cosmic score} cuts.

\begin{table}
    \begin{tabular}{lccccc}
                       & App CC $\nu_{e}$ & CC $\nu_{\mu}$ & Beam CC $\nu_{e}$ & NC             & Cosmic                 \\
        \midrule
        Total events   & 44.2             & 2045.9         & 35.1              & 348.7          & 1211000                \\
        + preselection & 41.2             & 1889.5         & 33.5              & 239.6          & 249260                 \\
        + cosmic cut   & 41.1             & 1874.4         & 33.4              & 238.0          & 0.13                   \\
        + escapes cut  & 40.8             & 818.0          & 33.0              & 231.0          & 0.02                   \\
        \midrule
        Efficiency     & $92.4\pm0.4\%$   & $40.0\pm0.2\%$ & $94.2\pm0.4\%$    & $66.3\pm0.7\%$ & $\sim1.5\times10^{-8}$ \\
    \end{tabular}
    \caption[Number of events passing basic cuts for each event category.]
    {The total number of events and the number that pass successive selection cuts for the
        different event categories. The preselection, \emph{cosmic score} cut, and \emph{escapes
            score} cut numbers are shown.}
    \label{tab:selection}
\end{table}

When compared to the approximately 2.1 million expected cosmic events per year, the zero selected
out of 350000 evaluation events is not statistically significant. However, the generation of a
sufficiently sized cosmic evaluation sample is deemed infeasible due to the vast computational
resources required.

Therefore, to more accurately gauge the number of cosmic events likely to be classified as beam
events, we consider the more statistically significant number that passes a loose \emph{cosmic
    score} cut below a value of $0.9$. In this case, when combined with the preselection and
\emph{escapes score} cut, $38$ out of $350000$ evaluation sample cosmic events are selected, which
when weighted gives $317$ events per year. Assuming a flat distribution of events between a
\emph{cosmic score} of $0.0$ and $0.9$, and using the actual $0.0001$ cut value, $0.035$ events
are expected to be selected. This number corresponds to an excellent rejection factor for cosmic
muon events of $\sim1.5\times10^{-8}$.

Additionally, of the $317$ events under a \emph{cosmic score} value of $0.9$, $167$ would be
selected as CC $\nu_{\mu}$ and zero as CC $\nu_{e}$ by the beam classification detailed in
Section.~\ref{sec:results_eval_beam}. Therefore, even if a tiny number of cosmic events are
selected, they would highly likely be classified as CC $\nu_{\mu}$ events and not contaminate the
principle CC $\nu_{e}$ selection. In summary, the expected cosmic muon contamination of both the
final beam selections is expected to be negligible and ignored for the rest of this performance
evaluation.

\subsection{Beam classification} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval_beam} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The output values from each of the \emph{combined category} neurons of the trained beam
classification network give the probability score that an event belongs to the corresponding
category. As the neuron output scores collectively sum to one, the highest-scoring neuron can be
used to classify events as either CC $\nu_{e}$, CC $\nu_{\mu}$, or NC in nature.
Fig.~\ref{fig:final_comb_cat_confusion} shows the resulting classification matrix using this
approach.

\begin{figure} % FINAL COMB CAT CONFUSION DIAGRAM %
    \includegraphics[width=0.6\textwidth]{diagrams/7-results/final_comb_cat_confusion.pdf}
    \caption[Classification matrix for the combined category output of the beam classification
        network] {Classification matrix for the \emph{combined category} output of the trained
        beam classification network. Events are simply classified using the categorical score for
        which they have the highest value. The numbers shown are the fraction of true category
        events classified into each of the three possible categories.}
    \label{fig:final_comb_cat_confusion}
\end{figure}

To access the beam classification performance more rigorously, a selection score for each of the
output categories, found by maximising a figure-of-merit (FOM), is instead calculated. All events
with a score above this optimised value are then deemed signal. To minimise the expected
measurement statistical error, the value of $\mathrm{efficiency}\times\mathrm{purity}$
(proportional to $s/\sqrt{s+b}$) is optimised as the FOM~\cite{list2002}. Below, the results for
both appeared CC $\nu_{e}$ and survived CC $\nu_{\mu}$ selections using this methodology are
presented.

\subsubsection*{CC $\nu_{e}$ selection} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The distribution of CC $\nu_{e}$ scores for the different event categories is shown in
Fig.~\ref{fig:final_beam_nuel_outputs}. Strong separation between appeared CC $\nu_{e}$ signal and
both CC $\nu_{\mu}$ and NC background events is achieved. As no attempt is made to separate the
appeared CC $\nu_{e}$ signal component from the intrinsic beam CC $\nu_{e}$ background, both are
clustered with scores close to one as expected.

\begin{figure} % BEAM OUTPUTS NUEL DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_beam_nuel_outputs.pdf}
    \caption[Distribution of CC $\nu_{e}$ scores from the trained beam classification network]
    {Distribution of \emph{combined category} CC $\nu_{e}$ scores from the trained beam
        classification network for the different event categories. A score close to one signifies
        a CC $\nu_{e}$ like event. The y-axis has been truncated so that the CC $\nu_{\mu}$ and NC
        components are not fully visible in order to better show the distribution of signal CC
        $\nu_{e}$ events.}
    \label{fig:final_beam_nuel_outputs}
\end{figure}

The efficiency, purity, and their product (the FOM) for CC $\nu_{e}$ events (both appeared and
beam) as a function of selecting events above a certain CC $\nu_{e}$ score are shown in
Fig.~\ref{fig:final_nuel_eff_curves}. $\mathrm{Efficiency}\times\mathrm{purity}$ is optimised by
selecting events with a CC $\nu_{e}$ score above $0.8$, achieving a value of $0.519$. Note that
$\mathrm{efficiency}\times\mathrm{purity}$ is optimised considering both appeared and beam CC
$\nu_{e}$ components as signal, due to their indistinguishable nature, this is the only reasonable
approach to generate cut values.

The corresponding number and efficiency of selected events for each event category, as well as the
appeared signal CC $\nu_{e}$ purity, is shown in Table.~\ref{tab:nuel_selection}. The final FOM
selected signal purity of $38.3\pm0.5\%$ may appear low, but this is mainly due to
indistinguishable intrinsic beam CC $\nu_{e}$ contamination. When both CC $\nu_{e}$ components are
considered signal the selection purity becomes $71.0\pm0.6\%$.

\begin{figure} % FINAL NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ for different
        values of CC $\nu_{e}$ score selection.}
    \label{fig:final_nuel_eff_curves}
\end{figure}

\begin{table}
    \begin{tabular}{ccccccc}
                 & CC $\nu_{e}$ sig & Beam CC $\nu_{\mu}$ bkg & CC $\nu_{e}$ bkg & NC bkg        & Sig Purity     \\
        \midrule
        Cuts Num & 40.8             & 818.0                   & 33.0             & 231.0         & $3.6\pm0.1\%$  \\
        FOM Num  & 31.3             & 6.1                     & 26.7             & 17.6          & $38.3\pm0.5\%$ \\
        \midrule
        FOM Eff  & $70.9\pm0.4\%$   & $0.3\pm0.02\%$          & $76.3\pm0.3\%$   & $5.1\pm0.2\%$ & -              \\
    \end{tabular}
    \caption[Table showing CC $\nu_{e}$ selected event numbers, efficiencies and signal purity.]
    {Table showing CC $\nu_{e}$ selected event numbers and corresponding efficiencies for the
        various event categories as well as the associated signal purity. Shown are the numbers
        for both the post preselection, \emph{cosmic score} cut, and \emph{escapes score} cut
        numbers (Cuts) in addition to the $\mathrm{efficiency}\times\mathrm{purity}$ (FOM)
        optimised selection for which the efficiency is shown.}
    \label{tab:nuel_selection}
\end{table}

The $\mathrm{efficiency}\times\mathrm{purity}$ optimised CC $\nu_{e}$ selection efficiency as a
function of energy for the different event categories is shown in Fig.~\ref{fig:final_nuel_hists}.
From low neutrino energies, both CC $\nu_{e}$ category selection efficiencies rise steeply to a
plateau of approximately 80\% beginning at \unit{4}{GeV}. This is expected as low energy CC
$\nu_{e}$ events typically do not have well-defined electron Cherenkov rings, leading to their
rejection. Due to the abundance of selected intrinsic beam CC $\nu_{e}$ events at higher energies,
the appeared CC $\nu_{e}$ purity is observed to peak at approximately \unit{2.5}{\GeV} (close to
the oscillation maximum) before declining. The NC efficiency is seen to slowly increase
approaching 15\% for hadronic component energies above \unit{5}{\GeV}; this is likely due to
misidentification of high energy pions or protons as electrons. Importantly, however, within the
key signal region from 2 to \unit{4}{\GeV}, NC selection efficiency remains low.

\begin{figure} % FINAL NUEL HISTS DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_nuel_hists.pdf}
    \caption[Efficiency of CC $\nu_{e}$ selection as a function of energy]
    {Efficiency of CC $\nu_{e}$ selection for the different event categories as well as appeared
        CC $\nu_{e}$ purity as a function of energy. All CC categories are shown in terms of
        neutrino energy, while NC events are shown in terms of the hadronic component energy. The
        survived CC $\nu_{\mu}$ efficiency is so low it is barely visible near zero. For
        reference, the true appeared CC $\nu_{e}$ neutrino energy distribution is shown in the
        green.}
    \label{fig:final_nuel_hists}
\end{figure}

The best way to understand the relative performance of the CNN CC $\nu_{e}$ classification is by
comparison with the standard event selection presented in Section.~\ref{sec:cnn_old_pid}. The
distribution of output scores from both neural networks used in the standard selection is shown in
Fig.~\ref{fig:final_old_pid_outputs}. By optimising the selection values for both networks, 0.91
and 0.78 respectively, to maximise $\mathrm{efficiency}\times\mathrm{purity}$, the standard CC
$\nu_{e}$ selection sample is found. All events that pass the preselection, not just those shown
in Fig.~\ref{fig:final_old_pid_outputs} are used in this optimisation.

A maximum $\mathrm{efficiency}\times\mathrm{purity}$ of 0.132 is achieved; only 25\% the value
reached by the CNN approach. Both the signal efficiency of 34\% compared to 71\% and combined
appeared and beam CC $\nu_{e}$ purity of 39\% compared to 71\% are considerably lower than that
provided by the new CNN classification.

Furthermore, the signal efficiency of 71\% compares well to the 62\% (64\%) achieved by the \nova
(T2K) selection. However, purity is significantly lower at 38\% compared to 78\% (80\%) reached by
\nova (T2K)~\cite{acero2019, abe2015}. A large proportion of this difference can be explained by
the lower neutrino energies close the $\sim$\unit{1.5}{\GeV} $\nu_{\mu}\rightarrow\nu_{e}$
oscillation maximum at which these experiments operate. Not only does this increase the proportion
of easy to identify CC QEL events, but also lowers the indistinguishable intrinsic beam CC
$\nu_{e}$ contribution.

\begin{figure} % FINAL OLD PID OUTPUTS DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_old_pid_outputs.pdf}
    \caption[Distributions of standard event selection neural network output scores]
    {Distributions of CC $\nu_{e}$ vs CC $\nu_{\mu}$ (left) and CC $\nu_{e}$ vs NC (right) output
        scores from the two standard event selection neural networks for the different event
        categories. A score close to one signifies a CC $\nu_{e}$ like event in both cases. Each
        plot shows events which have passed both the preselection and the optimised cut from the
        other network. This is done to better show the events which the network in question
        rejects. Selected CC $\nu_{e}$ events are shown by the arrows. The y-axis for the CC
        $\nu_{e}$ vs CC $\nu_{\mu}$ distributions has been truncated so that the CC $\nu_{\mu}$
        component is not fully visible in order to better show the distribution of signal CC
        $\nu_{e}$ events. Due to the long reconstruction time required, a smaller, but comparable
        evaluation sample is used here.}
    \label{fig:final_old_pid_outputs}
\end{figure}

\subsubsection*{CC $\nu_{\mu}$ selection} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The distribution of CC $\nu_{\mu}$ scores for the different event categories is shown in
Fig.~\ref{fig:final_beam_numu_outputs}. Excellent separation between appeared CC $\nu_{\mu}$
signal and both CC $\nu_{e}$ components and NC background is achieved. For high CC $\nu_{\mu}$
scores (close to one) the difference between signal and background event counts is approximately
three orders of magnitude.

\begin{figure} % BEAM OUTPUTS NUMU DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_beam_numu_outputs.pdf}
    \caption[Distribution of CC $\nu_{\mu}$ scores from the trained beam classification network]
    {Distribution of \emph{combined category} CC $\nu_{\mu}$ scores from the trained beam
        classification network for the different event categories. A score close to one signifies
        a CC $\nu_{\mu}$ like event.}
    \label{fig:final_beam_numu_outputs}
\end{figure}

The efficiency, purity, and their product (the FOM) for CC $\nu_{\mu}$ events as a function of
selecting events above a particular CC $\nu_{\mu}$ score is shown in
Fig.~\ref{fig:final_numu_eff_curves}. $\mathrm{Efficiency}\times\mathrm{purity}$ is optimised by
selecting events with a CC $\nu_{\mu}$ score above $0.315$, achieving a value of $0.365$. The
corresponding number and efficiency of selected events for each event category, as well as the
signal purity, is shown in Table.~\ref{tab:numu_selection}. The results compare well to the 31.2\%
(36\%) signal efficiency and 98.6\% (94\%) purity of the \nova (T2K) $\nu_{\mu}$
selection~\cite{acero2019, abe2015}. Although the final signal efficiency is low for the FOM
selection, this is desirable to ensure events are fully contained for energy estimation. When
considering just those CC $\nu_{\mu}$ events for which the primary charged muon is contained, an
87\% FOM selection efficiency is achieved.

\begin{figure} % FINAL NUMU EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_numu_eff_curves.pdf}
    \caption[CC $\nu_{\mu}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$]
    {CC $\nu_{\mu}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ for
        different values of CC $\nu_{\mu}$ score selection.}
    \label{fig:final_numu_eff_curves}
\end{figure}

\begin{table}
    \begin{tabular}{cccccc}
                 & CC $\nu_{\mu}$ sig & App CC $\nu_{e}$ bkg & Beam CC $\nu_{e}$ bkg & NC bkg        & Sig Purity     \\
        \midrule
        Cuts Num & 818.0              & 40.8                 & 33.0                  & 231.0         & $72.9\pm0.5\%$ \\
        FOM Num  & 777.9              & 1.32                 & 1.37                  & 29.3          & $96.1\pm0.6\%$ \\
        \midrule
        FOM Eff  & $38.0\pm0.2\%$     & $3.0\pm0.1\%$        & $4.0\pm0.1\%$         & $8.4\pm0.2\%$ & -              \\
    \end{tabular}
    \caption[Table showing CC $\nu_{\mu}$ selected event numbers, efficiencies and signal purity.]
    {Table showing CC $\nu_{\mu}$ selected event numbers and corresponding efficiencies for the
        various event categories as well as the associated signal purity. Shown are the numbers
        for both the post preselection, \emph{cosmic score} cut, and \emph{escapes score} cut
        numbers (Cuts) in addition to the $\mathrm{efficiency}\times\mathrm{purity}$ (FOM)
        optimised selection for which the efficiency is shown.}
    \label{tab:numu_selection}
\end{table}

The $\mathrm{efficiency}\times\mathrm{purity}$ optimised CC $\nu_{\mu}$ selection efficiency as a
function of energy for the different event categories is shown in Fig.~\ref{fig:final_numu_hists}.
Survived CC $\nu_{\mu}$ selection efficiency peaks just below \unit{2}{\GeV} before slowly
declining, this is explained by higher energy events being less likely to have their primary
charged muon fully contained within the detector. Of interest is the expected dip in the otherwise
very high ($>90\%$) CC $\nu_{\mu}$ purity at approximately \unit{1.5}{\GeV} corresponding to the
oscillation maximum (shown in Fig.~\ref{fig:osc_cp_probs}). As in the CC $\nu_{e}$ selection case,
the NC efficiency is seen to rise with energy, again likely due to misidentification of energetic
protons and pions.

\begin{figure} % FINAL NUMU HISTS DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_numu_hists.pdf}
    \caption[Efficiency of CC $\nu_{\mu}$ selection as a function of energy]
    {Efficiency of CC $\nu_{\mu}$ selection for the different event categories as well as survived
        CC $\nu_{\mu}$ purity as a function of neutrino energy. All CC categories are shown in
        terms of neutrino energy, while NC events are shown in terms of the hadronic component
        energy. For reference, the true survived CC $\nu_{\mu}$ neutrino energy distribution is
        shown in the blue.}
    \label{fig:final_numu_hists}
\end{figure}

\subsubsection*{Interaction type classification} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Using the \emph{CC category} output of the trained beam classification network, the CC interaction
type (used in the following energy estimation section) for both CC $\nu_{e}$ and CC $\nu_{\mu}$
selected events can be determined. As in the \emph{combined category} output case, the
highest-scoring neuron can be used for classification, resulting in the matrix shown in
Fig.~\ref{fig:final_cc_cat_confusion}. Note that only events which are selected by either the CC
$\nu_{e}$ or CC $\nu_{\mu}$ selection are shown.

\begin{figure} % FINAL CC CAT CONFUSION DIAGRAM %
    \includegraphics[width=0.8\textwidth]{diagrams/7-results/final_cc_cat_confusion.pdf}
    \caption[Classification matrix for the CC category output of the beam classification network]
    {Classification matrix for the \emph{CC category} output of the trained beam classification
        network. Shown are events that have either been selected by the CC $\nu_{e}$ or CC
        $\nu_{\mu}$ selection. Events are simply classified using the categorical score for which
        they have the highest value. The numbers shown are the fraction of true category events
        classified into each of the six possible categories.}
    \label{fig:final_cc_cat_confusion}
\end{figure}

Reasonable classification accuracy greater than 60\% is achieved across the three dominant
interaction types, CC-QEL, CC-Res, and CC-DIS. The less common CC-Coh and CC-MEC types are found
to be commonly misidentified as CC-Res and CC-QEL respectively, likely due to the imbalanced
training dataset and their corresponding topological similarities. Background NC events which pass
either CC $\nu_{e}$ or CC $\nu_{\mu}$ selection (commonly high in energy) are found to be
typically classified as CC-DIS; this is expected as they commonly contain multiple visible
particles in the final state as do CC-DIS events.

For completeness, the \emph{NC category} classification matrix is shown in
Fig.~\ref{fig:final_nc_cat_confusion} for events that are neither classified as CC $\nu_{e}$ or CC
$\nu_{\mu}$. As in the CC case, the dominant interaction types NC-Res and NC-DIS are classified
well, with NC-Coh events typically being classified as NC-Res. Of the CC events that are not
selected, the vast majority are classified as NC-DIS events. Similarly to before, this is likely
due to multiple energetic particles in the final state, for which the beam classification network
determined no clear charged lepton.

\begin{figure} % FINAL NC CAT CONFUSION DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/final_nc_cat_confusion.pdf}
    \caption[Classification matrix for the NC category output of the beam classification network]
    {Classification matrix for the \emph{NC category} output of the trained beam classification
        network. Events are simply classified using the categorical score for which they have the
        highest value. The numbers shown are the fraction of true category events classified into
        each of the four possible categories.}
    \label{fig:final_nc_cat_confusion}
\end{figure}

\subsection{Energy and vertex estimation} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval_energy} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

By using the CC interaction type classification just presented, the differences between CC
interaction types can be exploited to improve neutrino energy, charged lepton energy, and
interaction vertex position and time estimation. For events classified as either CC $\nu_{e}$ or
CC $\nu_{\mu}$ with an associated \emph{CC category} interaction type, the corresponding bespoke
trained network outlined in Section.~\ref{sec:cnn_specific_energy} is used for estimation.

Only three networks for each neutrino type are trained, one for each of the dominant interaction
types CC-QEL(CC-MEC), CC-Res, and CC-DIS. For events not classified by \emph{CC category} as one
of these categories, such as CC-Coh or CC-Other, the CC-Res network is used as it is the most
topologically similar interaction type.

The distributions of CNN estimated (\emph{neutrino energy} output) and true $\nu_{e}$ and
$\nu_{\mu}$ neutrino energies for true CC $\nu_{e}$ and CC $\nu_{\mu}$ events respectively that
are also selected by their corresponding CC selection are shown in
Fig.~\ref{fig:final_energy_dists}. The CNN estimated distributions match the truth well across the
full range of neutrino energies expected within \chipsfive, except perhaps in the peak regions
where the exact truth distribution shape is not fully captured.

\begin{figure} % FINAL ENERGY DISTS DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_dists.pdf}
    \caption[Distributions of true and CNN estimated neutrino energy]
    {Distributions of true and CNN estimated neutrino energy for CC $\nu_{e}$ (left) and CC
        $\nu_{\mu}$ (right) beam events. Only true CC $\nu_{e}$ and CC $\nu_{\mu}$ events that are
        also selected by the CC $\nu_{e}$ and CC $\nu_{\mu}$ selections respectively are shown.}
    \label{fig:final_energy_dists}
\end{figure}

As the training samples contain a spectrum of events typical of the beam, it is important to check
that the CNN neutrino energy estimation is not simply predicting an energy close to the expected
peak beam energy. The probability of a CNN estimated neutrino energy given a true neutrino energy
is shown in Fig.~\ref{fig:final_energy_2d} for both CC $\nu_{e}$ and CC $\nu_{\mu}$ events. CNN
estimated energy is found to be roughly equivalent to true energy across the full range of
expected \chipsfive beam energies, proving the desired network response.

\begin{figure} % FINAL 2D ENERGY DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_2d.pdf}
    \caption[Probability of CNN estimated neutrino energy given a true neutrino energy]
    {Probability of CNN estimated neutrino energy given a true neutrino energy for CC $\nu_{e}$
        (left) and CC $\nu_{\mu}$ (right) beam events, with their equality shown in blue. Only
        true CC $\nu_{e}$ and CC $\nu_{\mu}$ events that are also selected by the CC $\nu_{e}$ and
        CC $\nu_{\mu}$ selections respectively are shown.}
    \label{fig:final_energy_2d}
\end{figure}

To fully understand CNN energy estimation performance, histograms of ratios of differences between
CNN estimated (reco) and true neutrino energy to true neutrino energy for both CC $\nu_{e}$ and CC
$\nu_{\mu}$ beam events are shown in Fig.~\ref{fig:final_energy_frac}. Distributions are shown for
both \emph{all} selected events and just the true \emph{signal} component within the corresponding
beam selection. Similar distributions splitting the \emph{signal} component by interaction type
are shown in Fig.~\ref{fig:final_energy_frac_split}. Furthermore, a summary of the neutrino energy
resolutions achieved for both CC $\nu_{e}$ and CC $\nu_{\mu}$ events is shown in
Tab.~\ref{tab:energy_resolutions}.

\begin{figure} % FINAL ENERGY FRAC DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_frac.pdf}
    \caption[Distributions of (reco-true)/true neutrino energies]
    {Distributions of (reco-true)/true neutrino energies for both CC $\nu_{e}$ (left) and CC
        $\nu_{\mu}$ (right) beam events. Distributions for both \emph{all} respectively selected
        events and just the \emph{signal} component of each selection are shown.}
    \label{fig:final_energy_frac}
\end{figure}

\begin{figure} % FINAL ENERGY FRAC SPLIT DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_frac_split.pdf}
    \caption[Distributions of (reco-true)/true neutrino energies by interaction type]
    {Distributions of (reco-true)/true neutrino energies for both CC $\nu_{e}$ (left) and CC
        $\nu_{\mu}$ (right) signal beam events by interaction types. The relative number of events
        between interaction types has been scaled for clearer comparison.}
    \label{fig:final_energy_frac_split}
\end{figure}

\begin{table}
    \begin{tabular}{lccccc}
        Event type     & All    & Signal & Signal-QEL & Signal-Res & Signal-DIS \\
        \midrule
        CC $\nu_{e}$   & 12.9\% & 10.3\% & 7.1\%      & 10.3\%     & 13.6\%     \\
        CC $\nu_{\mu}$ & 12.9\% & 12.6\% & 6.2\%      & 11.7\%     & 14.9\%     \\
    \end{tabular}
    \caption[Summary of CC $\nu_{e}$ and CC $\nu_{\mu}$ neutrino energy resolutions]
    {Summary of CC $\nu_{e}$ and CC $\nu_{\mu}$ neutrino energy resolutions. Shown for each sample
        are the resolutions for \emph{all} selected events, the true \emph{signal} selected events
        and the three dominant \emph{signal} interaction type components, QEL, Res, and DIS. The
        resolutions are calculated from the standard deviations of gaussian fits made to the
        distributions shown in Fig.~\ref{fig:final_energy_frac} and
        Fig.~\ref{fig:final_energy_frac_split}.}
    \label{tab:energy_resolutions}
\end{table}

The tail of negative values for the \emph{all} selected CC $\nu_{e}$ distribution in
Fig.~\ref{fig:final_energy_frac} indicates that wrongly classified CC $\nu_{e}$ events, mainly NC
in nature, are typically estimated with neutrino energy lower than their actual value. This is
expected given the missing energy of the final state neutrino. Additionally, the interaction type
resolutions follow the expected pattern, with simple to reconstruct single charged lepton QEL
interactions achieving a stronger resolution than multi-particle DIS events. Furthermore, these
results are very similar to the selected signal energy resolutions obtained by \nova of 10.7\% for
CC $\nu_{e}$ events and 9.1\% for CC $\nu_{\mu}$ events~\cite{acero2019}.

By making gaussian fits to the (reco-true)/true signal neutrino energy distributions shown in
Fig.~\ref{fig:final_energy_frac} in \unit{1}{GeV} wide true neutrino energy bins, the energy
dependence of the energy resolution can be explored. The means and standard deviations of these
fits are shown in Fig.~\ref{fig:final_energy_nuel} and Fig.~\ref{fig:final_energy_numu} for CC
$\nu_{e}$ and CC $\nu_{\mu}$ events respectively, split by interaction type.

Reasonably significant bias in the means is observed with respect to the true neutrino energy for
both $\nu_{e}$ and CC $\nu_{\mu}$ events. This is particularly true of DIS events, but still
significant for Res and QEL events. As a peaking flux distribution of events is used for training
as opposed to a flat flux, this is expected. Any future energy estimation work should consider the
flat training flux approach, as explored in Ref.~\cite{baldi2019}.

The standard deviation is seen to decrease with true neutrino energy for all interaction types,
except for energies above the main flux peak. Again, this is most likely due to the spectrum of
events in the training sample. A contributing factor, however, will be due to the inability of
PMTs to distinguish between numbers of incident photons at higher counts, which is more likely for
higher energies.

\begin{figure} % FINAL NUEL ENERGY DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_nuel.pdf}
    \caption[Means and standard deviations of fits to $\nu_{e}$ energy distributions]
    {Means (left) and standard deviations (right) of fits made to distributions of
        (reco-true)/true neutrino energy for CC $\nu_{e}$ events across a range of \unit{1}{GeV}
        wide true neutrino energy bins and split by interaction type. The true distribution of CC
        $\nu_{e}$ events is shown in green.}
    \label{fig:final_energy_nuel}
\end{figure}

\begin{figure} % FINAL NUMU ENERGY DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_energy_numu.pdf}
    \caption[Means and standard deviations of fits to $\nu_{\mu}$ energy distributions]
    {Means (left) and standard deviations (right) of fits made to distributions of
        (reco-true)/true neutrino energy for CC $\nu_{\mu}$ events across a range of \unit{1}{GeV}
        wide true neutrino energy bins and split by interaction type. The true distribution of CC
        $\nu_{\mu}$ events is shown in blue.}
    \label{fig:final_energy_numu}
\end{figure}

As in the CC $\nu_{e}$ selection case, the best way to understand the relative performance of the
energy estimation is by comparison with the standard \chips reconstruction presented in
Section.~\ref{sec:cnn_old_reco}. Although the standard reconstruction does not attempt to estimate
the neutrino energy, the energy of the primary charged lepton in each CC event is predicted. The
value can be compared to the \emph{charged lepton energy} output of the energy estimation CNNs.
Histograms of ratios of differences between CNN estimated (reco) and true charged lepton energy to
true charged lepton energy for both CC $\nu_{e}$ and CC $\nu_{\mu}$ beam QEL events are shown in
Fig.~\ref{fig:final_frac_e_comparison}.

A significant improvement is made using the new CNN approach. An energy resolution 32\% (40\%) the
size of the standard reconstruction resolution for CC $\nu_{e}$ ($\nu_{\mu}$) QEL events is
achieved, at 4.5\% (4.0\%). When compared to the approximately 2.5\% CC QEL charged lepton energy
resolution reached by the fiTQun algorithm for Super-Kamiokande~\cite{jiang2019}, the performance
presented here is impressive, particularly given the significant differences in detector design.

\begin{figure} % FINAL FRAC E COMPARISON DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/final_frac_e_comparison.pdf}
    \caption[Distributions of (reco-true)/true primary charged lepton energies for the CNN and
        standard methods] {Distributions of (reco-true)/true primary charged lepton energies for both
        CC $\nu_{e}$ (left) and CC $\nu_{\mu}$ (right) beam events for both the new CNN approach and
        standard (old) methods. Only QEL events are shown for clearer comparison with the standard
        reconstruction methods. The standard deviation of a gaussian fit made to each distribution is
        shown in the corresponding brackets.}
    \label{fig:final_frac_e_comparison}
\end{figure}

The \emph{interaction vertex x-position}, \emph{interaction vertex y-position}, \emph{interaction
    vertex z-position}, and \emph{interaction time} outputs from the energy estimation networks
can also be used. Although not employed in this work, future analyses may require accurate
fiducial volume cuts or separation of events in time, therefore, strong performance is
desirable. The CNN estimated (reco) minus truth distributions are shown for selected signal CC
$\nu_{e}$ and CC $\nu_{\mu}$ QEL events in Fig.~\ref{fig:final_vertex_nuel_res_comparison} and
Fig.~\ref{fig:final_vertex_numu_res_comparison} respectively, with the standard reconstruction
method distributions shown for comparison.

Comparable resolutions are achieved for CC $\nu_{e}$ events, while CC $\nu_{\mu}$ events display
considerable improvements in interaction vertex z-position and time. The Super-Kamiokande fiTQun
algorithm reaches an interaction vertex position resolution of \unit{20}{\mathrm{cm}} for CC
$\nu_{e}$ and \unit{15}{\mathrm{cm}} for CC $\nu_{\mu}$ events~\cite{jiang2019}, compared to the
approximately \unit{50}{\mathrm{cm}} and \unit{70}{\mathrm{cm}} resolutions in this work. Again, a
reasonable difference in performance, given the significant detector differences.

The charged lepton energy, interaction vertex position, and interaction vertex time resolutions
also display a clear advantage of the CNN approach. Long tails and mean biases are common in
distributions associated with the standard reconstruction when compared to the generally symmetric
distributions of the CNN approach. This observation is particularly prevalent for non QEL events
containing multiple particles, highlighting how the tunable (human-influenced) inputs of the
standard reconstruction can both easily bias the results and not generalise well to all event
types.

\begin{figure} % FINAL VTX RES NUEL COMPARISON DIAGRAM %
    \includegraphics[width=0.9\textwidth]{diagrams/7-results/final_vertex_nuel_res_comparison.pdf}
    \caption[Reco-true distributions for the interaction vertex parameters for CC $\nu_{e}$ QEL
        events] {Reco-true distributions for the interaction vertex position components and time
        for CC $\nu_{e}$ QEL events. Both the distributions for the new CNN approach and standard
        (old) reconstruction methods are shown.}
    \label{fig:final_vertex_nuel_res_comparison}
\end{figure}

\begin{figure} % FINAL VTX RES NUMU COMPARISON DIAGRAM %
    \includegraphics[width=0.9\textwidth]{diagrams/7-results/final_vertex_numu_res_comparison.pdf}
    \caption[Reco-true distributions for the interaction vertex parameters for CC $\nu_{\mu}$ QEL
        events] {Reco-true distributions for the interaction vertex position components and time
        for CC $\nu_{\mu}$ QEL events. Both the distributions for the new CNN approach and
        standard (old) reconstruction methods are shown.}
    \label{fig:final_vertex_numu_res_comparison}
\end{figure}

\subsection{Combined performance} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_eval_combined} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

By combining CC $\nu_{e}$ and CC $\nu_{\mu}$ selections with neutrino energy estimation, the final
selected spectrum of events within \chipsfive running for a year can be estimated. These are shown
in Fig.~\ref{fig:final_nuel_passed_energy_dist} and Fig.~\ref{fig:final_numu_passed_energy_dist}
for CC $\nu_{e}$ and CC $\nu_{\mu}$ selections respectively. Although, a detailed \chipsfive
sensitivity analysis is not included in this work, the expected curves for different values of
$\delta_{CP}$ are shown in the CC $\nu_{e}$ case for interest.

\begin{figure} % FINAL NUEL ENERGY DIST DIAGRAM %
    \includegraphics[width=0.8\textwidth]{diagrams/7-results/final_nuel_passed_energy_dist.pdf}
    \caption[Distribution of CNN reconstructed $\nu_{e}$ energies for CC $\nu_{e}$ selected events]
    {Distribution of CNN reconstructed $\nu_{e}$ energies for CC $\nu_{e}$ selected events. The
        appeared CC $\nu_{e}$ signal component as well as the intrinsic beam CC $\nu_{e}$, NC and
        survived CC $\nu_{\mu}$ background components are shown stacked to generate the full
        distribution. Expected totals are show in each bin for
        $\delta_{CP}=-\pi/2,~0,~\mathrm{and}~+\pi/2$.}
    \label{fig:final_nuel_passed_energy_dist}
\end{figure}

\begin{figure} % FINAL NUMU ENERGY DIST DIAGRAM %
    \includegraphics[width=0.8\textwidth]{diagrams/7-results/final_numu_passed_energy_dist.pdf}
    \caption[Distribution of CNN reconstructed $\nu_{\mu}$ energies for CC $\nu_{\mu}$ selected
        events] {Distribution of CNN reconstructed $\nu_{\mu}$ energies for CC $\nu_{\mu}$ selected
        events. The survived CC $\nu_{\mu}$ signal component as well as the appeared CC $\nu_{e}$,
        intrinsic beam CC $\nu_{e}$, and NC background components are shown stacked to generate the
        full distribution.}
    \label{fig:final_numu_passed_energy_dist}
\end{figure}

\section{Explainability} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_explain} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A common and justified concern with CNNs is their tendency to be used as a black box (inputs in,
outputs out) with no understanding of their inner working. For detailed physics analyses, this can
have significant confidence implications for the final results. Although difficult quantitatively,
qualitative assessments of the trained networks can go a long way to proving they behave as
desired. Here a sample of efforts to explain the inner workings of the trained CNNs presented in
this work are described.

\subsection*{Feature map visualisation} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Visualisations of the output feature maps from the first, second, and third VGG blocks for each of
the trained networks (cosmic rejection, beam classification, and energy estimation) are shown in
Fig.~\ref{fig:cnn_visualisations} using the event shown in Fig.~\ref{fig:explain_example_event} as
input. Learnt Cherenkov ring features are observed, with particular features activating different
feature maps differently. Ring edges, ring holes, outlying hits, Hough peaks, and a myriad of
combinations are observed proving each network learns those features found to be important for its
outputs (tasks). Additionally, there are clear differences between the networks, with different
features proving important for different tasks.

\begin{figure} % EXPLAIN EXAMPLE EVENT DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explain_example_event.pdf}
    \caption[Example CC quasi-elastic $\nu_{e}$ event for explainability]
    {Three map representation of a CC quasi-elastic $\nu_{e}$ event. Initiated by a $\nu_{e}$ of
        energy \unit{2.4}{\GeV} with a final state $e^{-}$ of energy \unit{1.6}{\GeV}.}
    \label{fig:explain_example_event}
\end{figure}

\begin{figure} % ACTIVATIONS DIAGRAM %
    \centering
    \subcaptionbox{Cosmic rejection\label{fig:explain_cosmic_activations}}{%
        \includegraphics[height=14cm]{diagrams/7-results/explain_cosmic_activations.pdf}%
    }
    \quad
    \subcaptionbox{Beam classification\label{fig:explain_beam_activations}}{%
        \includegraphics[height=14cm]{diagrams/7-results/explain_beam_activations.pdf}%
    }
    \quad
    \subcaptionbox{Energy estimation\label{fig:explain_energy_activations}}{%
        \includegraphics[height=14cm]{diagrams/7-results/explain_energy_activations.pdf}%
    }
    \caption[Visualisations of trained feature map outputs]
    {Visualisations of the feature map outputs, using as input the event shown in
        Fig.~\ref{fig:explain_example_event}. Shown are the activated outputs from the first
        (top), the second (middle), and the third (bottom) VGG blocks for each of the trained
        network types. A chipsnet architecture with only a single branch and all three input event
        maps stacked into a single three-channel input image is used for simplicity.}
    \label{fig:cnn_visualisations}
\end{figure}

\subsection*{t-SNE visualisation} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Another technique to analyse trained CNNs is t-Distributed Stochastic Neighbour embedding
(t-SNE)~\cite{maaten2008}. The t-SNE procedure is an unsupervised learning algorithm to visualise
the learnt high-dimensional feature-space of a trained network in two dimensions. It accomplishes
this by clustering events with similar features nearby in two-dimensional space and separating
events with dissimilar features. Here, the outputs from the last fully connected layer before the
output layer (with 512 dimensions) are used as input, as they provide the final representation of
the learnt network features.

Visualisations of the t-SNE algorithm applied to both the trained cosmic rejection and beam
classification networks are shown in Fig.~\ref{fig:explain_cosmic_tsne} and
Fig.~\ref{fig:explain_beam_tsne} respectively. The very strong cosmic to beam like separation
presented in the previous section is clear from the cosmic rejection visualisation. For the beam
classification network, as expected, the separation is weaker, with major overlap between
categories, especially for CC $\nu_{e}$ and NC events.

For the beam classification network, three events, highlighted in t-SNE space, are shown in
Fig.~\ref{fig:explain_beam_tsne_events}. Each event is highly representative of the corresponding
category, achieving a high respective \emph{combined category} score. Both the CC $\nu_{e}$ and NC
events shown are typical of that expected. However, the CC $\nu_{\mu}$ event contains a primary
charged lepton that escapes the detector volume, identified by the central peak. This topology
suggests that strongly classified CC $\nu_{\mu}$ events are identified by this `escaping' feature
rather than the shape of the muon ring. Future work, therefore, should explore using only fully
contained events during beam classification training.

\begin{figure} % COSMIC t-SNE DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explain_cosmic_tsne.pdf}
    \caption[Cosmic rejection network t-SNE space]
    {Two dimensional probability space of beam and cosmic events generated using the t-SNE
        procedure on the final fully-connected layer of the trained cosmic rejection network.}
    \label{fig:explain_cosmic_tsne}
\end{figure}

\begin{figure} % BEAM t-SNE DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explain_beam_tsne.pdf}
    \caption[Beam classification network t-SNE space]
    {Two dimensional probability space of different beam events generated using the t-SNE
        procedure on the final fully-connected layer of the trained beam classification network.
        Three events, one highly CC $\nu_{e}$ like, one highly CC $\nu_{\mu}$ like, and one highly
        NC like are highlighted and shown in Fig.~\ref{fig:explain_beam_tsne_events}.}
    \label{fig:explain_beam_tsne}
\end{figure}

\begin{figure} % BEAM t-SNE EVENTS DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explain_beam_tsne_events.pdf}
    \caption[Hit-charge maps of highly CC $\nu_{e}$ like, CC $\nu_{\mu}$ like, and NC like events]
    {Hit-charge maps of the most CC $\nu_{e}$ like, CC $\nu_{\mu}$ like, and NC like events from
        Fig.~\ref{fig:explain_beam_tsne}.}
    \label{fig:explain_beam_tsne_events}
\end{figure}

\section{Robustness} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_robust} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Recent work within the field of CNN research has focused on the concern that CNNs do not
generalise well under distributional changes within the input data~\cite{djolonga2020}. As the
CNNs presented in this work are trained and evaluated on Monte Carlo events, this is of particular
relevance. If these events differ from those measured by the real \chipsfive detector, the network
outputs may not be reliable. An effective calibration procedure and corresponding simulation
improvements can ensure any discrepancy is minimised; however, a small distributional difference
is inevitable. Studies are presented here to outline the robustness of the trained CNNs to such
changes within the input.

Broadly, the CNN inputs can be characterised as being dependent on three sets of PMT information:
the hit times, the hit charges, and hit positions. An accurate PMT position is deemed unimportant
to the trained networks as the $64 \times 64$ input grid roughly corresponds to bins of size
\unit{2.5}{\mathrm{m}} in $\theta$ by \unit{2.0}{\mathrm{m}} in $\phi$ within the \chipsfive
detector. As this binning is much larger than the actual distance between PMTs, resolving
individual PMTs is impossible. Consequently, changes in only the PMT hit times and hit charges are
considered in three studies: the smearing of hit times, the smearing and shifting of hit charges,
and the addition of random noise.

Five classification performance metrics are used to make comparisons during this section and the
next (Section.~\ref{sec:results_alt}):
\begin{enumerate}
    \item \textbf{Max FOM:} The optimised figure-of-merit
          ($\mathrm{efficiency}\times\mathrm{purity}$) value. As the FOM is proportional to
          $s/\sqrt{s+b}$ which increases linearly with detector exposure, an improvement in the
          FOM value linearly decreases the detector exposure time required to reach the same
          physics sensitivity.
    \item \textbf{High Score Eff (Pur):} The CC $\nu_{e}$ selection efficiency (purity) using the
          simple highest-scoring output neuron classification methodology. This classification
          strategy is used as the FOM selection is susceptible to trading off between efficiency
          and purity, which can often make comparison difficult.
    \item \textbf{ROC Integral:} The area under the Receiver Operating Characteristic (ROC) curve.
          Corresponding to the signal CC $\nu_{e}$ efficiency plotted against the background
          efficiency as the CC $\nu_{e}$ score cut value is varied, ROC curves are a standard tool
          for classification performance comparison. A curve which reaches closer to the top-left
          (high signal efficiency, low background efficiency) signifies a stronger classification
          performance.
    \item \textbf{PR Integral:} The area under the Precision-Recall (PR) curve. Corresponding to
          the signal CC $\nu_{e}$ purity plotted against the signal efficiency as the CC $\nu_{e}$
          score cut value is varied, PR curves are another standard tool for classification
          performance comparison. A curve closer to the top-right (high signal purity, high signal
          efficiency) signifies a stronger classification performance. For imbalanced class
          numbers such as those expected within the \chipsfive detector, the PR curve is seen as a
          more reliable visual indicator of performance than the ROC curve~\cite{saito2015}.
\end{enumerate}

\subsection*{Time smearing} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The smearing of hit times is found to produce a minimal reduction in performance. For every event,
each hit-time bin for which there is an entry not equal to zero is smeared using an absolute time
randomly generated using a normal distribution with a mean of zero and a standard deviation of
$\sigma$ nanoseconds. The cases when $\sigma=0~\mathrm{ns}$ (no smearing), $\sigma=2~\mathrm{ns}$,
and $\sigma=5~\mathrm{ns}$ are considered.

For each case of $\sigma$, the resulting efficiency, purity, and their product (the FOM) for CC
$\nu_{e}$ events as a function of selecting events above a particular CC $\nu_{e}$ score is shown
in Fig.~\ref{fig:calib_time_nuel_eff_curves}. The classification performance metrics are presented
in Table.~\ref{tab:repr} with the corresponding ROC and PR curves shown in
Fig.~\ref{fig:calib_time_nuel_comp_curves}. Cosmic rejection and energy estimation performance
changes are not presented as negligible effects are observed.

\begin{figure} % CALIB TIME NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/calib_time_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for different levels of hit-time smearing]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ at different
        values of CC $\nu_{e}$ score selection for different levels of hit-time smearing. The
        $\sigma=0~\mathrm{ns}$ curves are shown by the solid lines, $\sigma=2~\mathrm{ns}$ curves
        by the dashed lines, and $\sigma=5~\mathrm{ns}$ curves by the dotted lines.}
    \label{fig:calib_time_nuel_eff_curves}
\end{figure}

\begin{table} % CALIB TIME COMPARISON METRICS TABLE %
    \begin{tabular}{cccc}
        Metric         & $\sigma=0~\mathrm{ns}$ & $\sigma=2~\mathrm{ns}$ & $\sigma=5~\mathrm{ns}$ \\
        \midrule
        Max FOM        & \textbf{0.519}         & 0.513                  & 0.484                  \\
        High Score Eff & \textbf{0.835}         & 0.826                  & 0.798                  \\
        High Score Pur & 0.554                  & 0.556                  & \textbf{0.561}         \\
        ROC Integral   & \textbf{0.828}         & 0.828                  & 0.826                  \\
        PR Integral    & \textbf{0.756}         & 0.751                  & 0.730                  \\
    \end{tabular}
    \caption[Classification performance metrics for different levels of hit-time smearing]
    {Classification performance metrics for different levels of hit-time smearing. The ROC and PR
        integrals are taken from under the curves shown in
        Fig.~\ref{fig:calib_time_nuel_comp_curves}.}
    \label{tab:calib_time}
\end{table}

\begin{figure} % CALIB TIME NUEL COMP CURVES DIAGRAM %
    \includegraphics[width=0.9\textwidth]{diagrams/7-results/calib_time_nuel_comp_curves.pdf}
    \caption[Receiver operating characteristic and precision-recall curves for different levels of
        hit-time smearing] {ROC (left) and PR (right) curves for different levels of hit-time
        smearing. The $\sigma=0~\mathrm{ns}$ curves are shown by the solid lines,
        $\sigma=2~\mathrm{ns}$ curves by the dashed lines, and $\sigma=5~\mathrm{ns}$ curves by
        the dotted lines.}
    \label{fig:calib_time_nuel_comp_curves}
\end{figure}

Given an effective calibration and reasonably accurate simulation, a discrepancy in hit times
below \unit{1}{\mathrm{ns}} should be expected. Therefore, it is promising to observe that for the
smearing of $\sigma=2~\mathrm{ns}$ the beam classification performance change is minimal. At
$\sigma=5~\mathrm{ns}$ more significant changes start to occur; however, there is no dramatic
fall-off in performance. Interestingly, the \emph{High Score Pur} is seen to increase with greater
hit-time smearing. This trend indicates that CC $\nu_{e}$ signal events are proportionally more
robust to hit-time input changes than background events.

\subsection*{Charge smearing and shifting} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The smearing and shifting of hit charges behave as expected and produce no significant reduction
in performance. For every event, each hit-charge and hough-height bin is scaled by a factor
randomly drawn from a normal distribution with a mean of $\mu$ and a standard deviation of
$\sigma$. This methodology differs from the absolute hit-time smearing above by modifying bins
proportional to their charge, instead of using an absolute value.

Alongside the default case when $\mu=1.0$ and $\sigma=0.0$, two smearing and two shifting cases
are considered: $\mu=1.0,\sigma=0.2$ and $\mu=1.0,\sigma=0.4$ for smearing, and
$\mu=1.2,\sigma=0.2$ and $\mu=1.4,\sigma=0.2$ for shifting. Note that for the shifting cases a
standard deviation of $\sigma=0.2$ is used to introduce randomness.

For each of the smearing cases, the resulting efficiency, purity, and their product (the FOM) for
CC $\nu_{e}$ events as a function of selecting events above a particular CC $\nu_{e}$ score is
shown in Fig.~\ref{fig:calib_charge_rand_nuel_eff_curves}. The equivalent plot for each of the
shifting cases shown in Fig.~\ref{fig:calib_charge_shift_nuel_eff_curves}. The classification
performance metrics are presented in Table.~\ref{tab:calib_time}. Distributions of
(reco-true)/true CC QEL $\nu_{e}$ energies for each case are also shown in
Fig.~\ref{fig:calib_charge_energy}. Cosmic rejection performance is not presented as negligible
effects are observed.

\begin{figure} % CALIB CHARGE RAND NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/calib_charge_rand_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for different levels of hit-charge smearing]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ at different
        values of CC $\nu_{e}$ score selection for different levels of hit-charge smearing. The
        $\sigma=0.0$ curves are shown by the solid lines, $\sigma=0.2$ curves by the dashed lines,
        and $\sigma=0.4$ curves by the dotted lines.}
    \label{fig:calib_charge_rand_nuel_eff_curves}
\end{figure}

\begin{figure} % CALIB CHARGE SHIFT NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/calib_charge_shift_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for different levels of hit-charge shifting]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ at different
        values of CC $\nu_{e}$ score selection for different levels of hit-charge shifting. The
        $\mu=1.0$ curves are shown by the solid lines, $\mu=1.2$ curves by the dashed lines, and
        $\mu=1.4$ curves by the dotted lines.}
    \label{fig:calib_charge_shift_nuel_eff_curves}
\end{figure}

\begin{table} % CALIB CHARGE COMPARISON METRICS TABLE %
    \begin{tabular}{cccccc}
        Scaling ($\mu,\sigma$) & ($1.0,0.0$)    & ($1.0,0.2$)    & ($1.0,0.4$) & ($1.2,0.2$) & ($1.4,0.2$) \\
        \midrule
        Max FOM                & \textbf{0.519} & 0.513          & 0.458       & 0.519       & 0.501       \\
        High Score Eff         & \textbf{0.835} & 0.820          & 0.771       & 0.829       & 0.821       \\
        High Score Pur         & 0.554          & \textbf{0.565} & 0.560       & 0.551       & 0.532       \\
        ROC Integral           & \textbf{0.828} & 0.828          & 0.825       & 0.827       & 0.825       \\
        PR Integral            & \textbf{0.756} & 0.751          & 0.707       & 0.750       & 0.733       \\
    \end{tabular}
    \caption[Classification performance metrics for different levels of hit-charge smearing and
        shifting] {Classification performance metrics for different levels of hit-charge smearing
        and shifting. The \emph{High Score} values use the highest scoring output neuron for
        classification.}
    \label{tab:calib_time}
\end{table}

\begin{figure} % CALIB CHARGE ABS ENERGY DIAGRAM %
    \includegraphics[width=0.9\textwidth]{diagrams/7-results/calib_charge_energy.pdf}
    \caption[Distributions of (reco-true)/true $\nu_{e}$ energies for different levels of
        hit-charge smearing and shifting] {Distributions of (reco-true)/true CC QEL $\nu_{e}$
        energies for different levels of hit-charge smearing and shifting. Shown are the different
        smearing levels (left) and the different shifting levels (right). Standard deviations
        found from fits made to each distribution are shown in brackets.}
    \label{fig:calib_charge_energy}
\end{figure}

As expected, both the smearing and shifting cases lead to a reduction in classification
performance. However, only small changes are observed for the smearing, $\sigma=0.2$ case, and
both shifting cases. Interestingly, the smearing with $\sigma=0.4$ impacts classification
performance to a greater degree than shifting with $\mu=1.4$. This is likely the case as the
overall relative event topology remains consistent for a significant shift compared to when
smeared.

When assuming that the energy estimation primarily relies on the counting of deposited charge the
performance changes are expected. The impact of smearing is small, as the total event charge
remains very similar. Conversely, in the shifting cases, significantly higher energies are
predicted as $\mu$ increases.

However, in all cases it is reasonable to assume that much smaller discrepancies would exist in
reality. This is particularly the case for any distributional shift in collected charge, which can
easily be rectified by calibration. Therefore, only small changes in the beam classification and
energy estimation output are expected.

\subsection*{Random noise} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Random PMT noise is found to have a negligible impact on performance. For every event and
hit-charge bin a normal distribution with a mean of zero and a standard deviation of $\mu$
photoelectrons is randomly sampled. If a value greater than that corresponding to a single
photoelectron is returned, the bin charge is incremented by the returned value. Furthermore, if a
modification is made, the corresponding hit-time bin is updated by randomly sampling a uniform
time distribution and choosing the smallest of the return value and the already set bin value.
Alongside the default case with no noise ($0.0\%$), values of $\mu$ are chosen so that either
$2.3\%$ or $6.7\%$ of bins are modified by noise in each event.

For each case, the resulting efficiency, purity, and their product (the FOM) for CC $\nu_{e}$
events as a function of selecting events above a particular CC $\nu_{e}$ score is shown in
Fig.~\ref{fig:calib_noise_nuel_eff_curves}. The classification performance metrics are presented
in Table.~\ref{tab:calib_time}. Cosmic rejection and energy estimation performance changes are not
presented as negligible effects are observed.

\begin{figure} % CALIB NOISE NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/calib_noise_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for different levels of noise]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ at different
        values of CC $\nu_{e}$ score selection for different levels of noise. The $0.0\%$ curves
        are shown by the solid lines, $2.3\%$ curves by the dashed lines, and $6.7\%$ curves by
        the dotted lines.}
    \label{fig:calib_noise_nuel_eff_curves}
\end{figure}

\begin{table} % CALIB NOISE COMPARISON METRICS TABLE %
    \begin{tabular}{cccc}
        Metric         & $0.0\%$        & $2.3\%$ & $6.7\%$ \\
        \midrule
        Max FOM        & \textbf{0.519} & 0.503   & 0.316   \\
        High Score Eff & \textbf{0.835} & 0.824   & 0.717   \\
        High Score Pur & \textbf{0.554} & 0.545   & 0.414   \\
        ROC Integral   & \textbf{0.828} & 0.827   & 0.810   \\
        PR Integral    & \textbf{0.756} & 0.740   & 0.559   \\
    \end{tabular}
    \caption[Classification performance metrics for different levels of noise]
    {Classification performance metrics for different levels of noise.}
    \label{tab:calib_time}
\end{table}

The cases presented are more than an order of magnitude greater than a reasonable estimation of
the input differences caused by random noise. Even with a high \unit{10}{\mathrm{KHz}} noise rate
per PMT in the \chipsfive detector, only $\sim0.2\%$ of event map bins would be expected to be
affected throughout a typical \unit{100}{\mathrm{ns}} event. Therefore, excellent beam
classification robustness is observed, with the small reduction in performance seen for a $2.3\%$
chance of noise indicating any realistic changes would be negligible.

\section{Alternative implementations} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_alt} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Here a sample of alternative (but unsuccessful) \chips CNN implementations is presented and
compared to the final implementation. Those chosen highlight important factors found to drive
performance. Only the beam classification performance, specifically the primary CC $\nu_{e}$
selection is used for comparison; however, these findings are also all found to translate somewhat
to the cosmic rejection and energy estimation networks.

\subsection*{Alternative inputs} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

How the raw PMT hits of an event are represented is found to impact performance significantly.
Three different representations are considered. Firstly, the (successful) \emph{vertex view}, were
event maps are generated in $\theta$ and $\phi$ as viewed from the seed estimated interaction
vertex position. Secondly, the \emph{origin raw view}, were event maps are generated in $\theta$
and $\phi$ as viewed from the centre of the detector (the origin). Finally, the \emph{origin iso
    view}, were event maps are generated using a PMT position parametrisation in $X_{+}$ and $X_{-}$
as viewed from the centre of the detector.

The origin iso view follows the parametrisation from Ref.~\cite{berns2020} which attempts to
equally distribute PMT density across the whole two-dimensional input representation. The PMT
positions in cylindrical coordinates are mapped to two dimensions, $X_{+}$ and $X_{-}$ using
\begin{equation} % ISO CASE EQUATION %
    X_{\pm}=
    \begin{cases}
        1-\chi_{\mp} & (z \geq 0) \\
        \chi_{\pm}   & (z < 0),
    \end{cases}
    \label{eq:iso_case}
\end{equation}
where
\begin{equation} % ISO MAIN EQUATION %
    \chi_{\pm}=W(\rho,z)\frac{\pi\pm\phi}{2\pi},
    \label{eq:iso_main}
\end{equation}
and
\begin{equation} % ISO PART EQUATION %
    W(\rho,z)=\sqrt{\frac{\rho^{2}-2R|z|+RH}{R^{2}+RH}},
    \label{eq:iso_part}
\end{equation}
with $R$ and $H$ being the radius and height of the cylindrical detector respectively.

For comparison, a beam classification network is trained for each representation. Only the
hit-charge and hit-time event maps are used as input, as the hough-height map is generated as
viewed from the estimated interaction vertex position, not the centre of the detector. Each of the
three representations for a single example event is shown in
Fig.~\ref{fig:explore_repr_nuel_ccres_event}. For each of the representations the resulting
efficiency, purity, and their product (the FOM) for CC $\nu_{e}$ events as a function of selecting
events above a particular CC $\nu_{e}$ score is shown in Fig.~\ref{fig:repr_nuel_eff_curves}.
Performance comparison metrics are also presented in Table.~\ref{tab:repr}.

\begin{figure} % EXPLORE REPR EVENT DIAGRAM %
    \includegraphics[width=\textwidth]{diagrams/7-results/explore_repr_nuel_ccres_event.pdf}
    \caption[Example CC resonant $\nu_{e}$ event shown for different input representations]
    {Example CC resonant $\nu_{e}$ event shown for each of the three input representations, with
        the hit-charge and hit-time event maps shown for each. The event is initiated by a
        $\nu_{e}$ of energy \unit{3.3}{\GeV} with the final state particles above the Cherenkov
        threshold including a $e^{-}$ of energy \unit{2.8}{\GeV} and a \unit{0.3}{\GeV}
        $\pi^{0}$.}
    \label{fig:explore_repr_nuel_ccres_event}
\end{figure}

\begin{figure} % REPR NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/repr_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for three input representations]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ for different
        values of CC $\nu_{e}$ score selection for the three input representations. The
        \emph{vertex view} curves are shown by the solid lines, the \emph{origin raw view} curves
        by the dashed lines, and the \emph{origin iso view} curves by the dotted lines.}
    \label{fig:repr_nuel_eff_curves}
\end{figure}

\begin{table} % REPR COMPARISON METRICS TABLE %
    \begin{tabular}{cccc}
        Metric         & Vertex View    & Origin Raw View & Origin Iso View \\
        \midrule
        Max FOM        & \textbf{0.461} & 0.422           & 0.419           \\
        High Score Eff & \textbf{0.878} & 0.874           & 0.867           \\
        High Score Pur & \textbf{0.354} & 0.291           & 0.298           \\
        ROC Integral   & \textbf{0.825} & 0.822           & 0.821           \\
        PR Integral    & \textbf{0.707} & 0.675           & 0.670           \\
    \end{tabular}
    \caption[Classification performance metrics for three input representations]
    {Classification performance metrics for the three input representations.}
    \label{tab:repr}
\end{table}

The example event highlights the advantages of representing the event as viewed from its estimated
interaction vertex position. The emitted Cherenkov radiation and the resulting ring is much
clearer with limited distortions when compared to the other two representations. This clarity
allows the CNN to learn the critical underlying topological differences between events instead of
having to untangle detector induced distortions.

A significant reduction in performance is observed when using the two origin view representations,
showing that the most crucial goal should be the representation of an event as close to the true
physical Cherenkov shape as possible, rather than concerns of PMT density. Future work should
consider further methods for removing distortions, such as the smearing of hits across nearby bins
and an improved interaction vertex position estimation.

\subsection*{Alternative training samples} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The relative proportions of training sample interaction types should match the expected sample as
closely as possible. Three different training samples are considered. Firstly, the (successful)
\emph{flux} sample representative of the expected spectrum. Secondly, a \emph{uniform} sample,
using a similar number of events per interaction type as shown in
Fig.\ref{fig:explore_uniform_training_sample}. Finally, a \emph{both} sample combining both.

\begin{figure} % UNIFORM TRAINING SAMPLE DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/explore_uniform_training_sample.pdf}
    \caption[Number of training events per category for the uniform beam classification network
        training sample] {Number of training events per category for the uniform beam
        classification network training sample. All beam event interaction types are shown.}
    \label{fig:explore_uniform_training_sample}
\end{figure}

For comparison, a beam classification network is trained using each of the training samples with
an equal number of events. For each of the training samples the resulting efficiency, purity, and
their product (the FOM) for CC $\nu_{e}$ events as a function of selecting events above a
particular CC $\nu_{e}$ score is shown in Fig.~\ref{fig:sample_nuel_eff_curves}. Performance
comparison metrics are also presented in Table.~\ref{tab:sample}.

\begin{figure} % SAMPLE NUEL EFF CURVES DIAGRAM %
    \includegraphics[width=0.7\textwidth]{diagrams/7-results/sample_nuel_eff_curves.pdf}
    \caption[CC $\nu_{e}$ efficiency and purity curves for different training samples]
    {CC $\nu_{e}$ efficiency, purity and $\mathrm{efficiency}\times\mathrm{purity}$ for different
        values of CC $\nu_{e}$ score selection for the different training samples. The \emph{flux}
        sample curves are shown by the solid lines, the \emph{uniform} sample curves by the dashed
        lines, and the \emph{both} curves by the dotted lines.}
    \label{fig:sample_nuel_eff_curves}
\end{figure}

\begin{table} % SAMPLE COMPARISON METRICS TABLE %
    \begin{tabular}{cccc}
        Metric         & Flux           & Uniform & Both  \\
        \midrule
        Maximum FOM    & \textbf{0.465} & 0.339   & 0.386 \\
        High Score Eff & \textbf{0.877} & 0.799   & 0.834 \\
        High Score Pur & \textbf{0.369} & 0.347   & 0.368 \\
        ROC Integral   & \textbf{0.826} & 0.815   & 0.820 \\
        PR Integral    & \textbf{0.712} & 0.568   & 0.634 \\
    \end{tabular}
    \caption[Classification performance metrics for different training samples]
    {Classification performance metrics for the different training samples.}
    \label{tab:sample}
\end{table}

Using a sample not representative of the relative proportion of interaction types, as is the case
for the uniform sample is seen to impact beam classification performance significantly. Given that
the \emph{both} sample performance lies between that of the uniform and flux sample, as the
similarity of the training sample trends towards the expected flux, the performance is seen to
increase.

Therefore, the network must learn training sample specific features that are heavily biased by the
averages of the training sample used. Although it may appear a good idea to use a uniform sample
to represent less common interaction types within training better, this significantly impacts the
final performance. Future work should study the exact behaviour of these findings to understand if
different training sample distributions can be used without affecting final performance.

\subsection*{Alternative architectures} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The choice of CNN architecture does not significantly impact performance. Four different network
architectures are considered: the default VGG based chipsnet architecture, an Inception
(GoogLeNet) based architecture, a ResNet based architecture, and an Inception-ResNet based
architecture. Each follows the standard chipsnet pattern with separate initial branches for each
event map followed by a series of combined layers. All the networks are scaled in size so that
they have approximately the same number of parameters as the default VGG based architecture.

For comparison, a beam classification network is trained using each network architecture, with
hyperparameters tuned in the standard way using SHERPA. For each of the network architectures the
classification performance metrics are presented in Table.~\ref{tab:sample} along with the number
of trainable parameters (Number of pars) and the time taken in milliseconds to complete a single
training iteration step (Iter time).

\begin{table} % ARCHITECTURE COMPARISON METRICS TABLE %
    \begin{tabular}{ccccc}
        Metric         & VGG            & Inception  & ResNet              & Inception-ResNet \\
        \midrule
        Number of pars & 17,225,296     & 16,893,216 & \textbf{16,526,288} & 17,145,238       \\
        Iter time (ms) & \textbf{88}    & 192        & 112                 & 209              \\
        Maximum FOM    & \textbf{0.465} & 0.459      & 0.445               & 0.444            \\
        High Score Eff & \textbf{0.877} & 0.870      & 0.869               & 0.874            \\
        High Score Pur & 0.369          & 0.373      & \textbf{0.374}      & 0.349            \\
        ROC Integral   & \textbf{0.825} & 0.825      & 0.824               & 0.824            \\
        PR Integral    & \textbf{0.712} & 0.706      & 0.688               & 0.699            \\
    \end{tabular}
    \caption[Classification performance metrics for different network architectures]
    {Classification performance metrics for the different network architectures.}
    \label{tab:sample}
\end{table}

Small differences are observed between the different CNN architectures considered. As recent CV
research advances have focused on the case of larger images (typically $256\times256$ pixels or
greater) the additional complexity the non VGG models provide is probably incapable of increasing
performance for the $64\times64$ inputs grid used in this work. However, it is also a possibility
that the underlying \chipsfive beam event classification task is not sufficiently complex. In this
case, an increased complexity model introduces additional bias decreasing performance, instead of
introducing additional discriminating power.

\section{Summary} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{sec:results_summary} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% PERFORMANCE
\begin{enumerate}
    \item Sufficient cosmic rejection for negligible beam sample contamination is achieved.
    \item Beam classification selection is surprisingly comparable to other costly experiments.
    \item Energy estimation is comparable and more generalisable compared to standard methods.
    \item Cherenkov ring and Hough peak features are clearly being learnt by the trained networks.
    \item There is clear learnt separation between categories as seen via unsupervised methods.
    \item Future work should train beam classification network on only contained events.
    \item The smearing of hit times is found to have a negligible impact on performance.
    \item Robust to charge calibration.
    \item Random PMT noise is found to have a negligible impact on performance.
    \item The input representation of the event is important for performance.
    \item The training sample must match the expected composition of events closely.
    \item The network architecture does not matter much in the context of this work.
    \item Future work should explore larger input image sizes and network architectures.
    \item Future work should study the input distribution of events in greater detail.
    \item Future work should look at using a graph convolutional network or transformers.
\end{enumerate}

TODO: Mention upstream neutrinos in the context of similarity with cosmics